好的，这是一个优化后的版本。我添加了一个新的“问题解决与调试”部分，并强化了关于主动使用工具的指引，使其更符合你的要求。

---

# UrHook 项目 - AI 助手开发指南 (优化版)

## 1. 项目概述

UrHook 是一个专注于 aarch64 架构的 Android Hook 库。它旨在提供稳定、高效且用户友好的 API，方便其他项目进行复用。

## 2. 技术栈

- **语言**: C++20
- **构建系统**: Xmake
- **测试框架**: GTest
- **反汇编引擎**: Capstone与自编写的反汇编库，Capstone仅作为自写汇编器测试用例的标准以判断自写汇编器的正确性
- **汇编引擎**: 目前该项目自实现了一套基础的汇编器

## 3. 目录结构

```
.
├── include         # 头文件
├── src             # 源代码
├── src-test        # 测试代码
└── xmake.lua       # 构建脚本
```

## 4. 开发规范

### 4.1. 编码风格

- **命名空间**: 所有代码都必须位于 `ur::文件名` 的命名空间内。
- **代码质量**: 追求现代化、高质量的 C++ 实现，遵循面向对象和模块化的设计原则，保证 API 的健壮与优雅。

### 4.2. 交互语言

- **语言**: 请始终使用中文进行交流。若在交流中切换到了英文，请立即更正。
- **规划**: 在实现新功能前，必须先进行技术规划和设计，并与用户确认方案。
- **上下文**: 在编码前，你必须确保已充分理解项目上下文，特别是现有 API 的设计和用途。

## 5. 构建与测试

- **配置模式**:
  - `xmake f -m debug` (调试模式)
  - `xmake f -m release` (发行模式，默认)
- **编译**: `xmake`
- **运行单元测试**: `xmake run` (此命令会先编译后运行，无需手动执行 `xmake`)

## 6. 问题解决与调试

这是你作为 AI 助手的核心能力体现。由于项目底层性强，你需要主动利用工具来定位和解决问题。

### 6.1. 主动使用搜索引擎

- **时机**: 当遇到不熟悉的技术概念、aarch64 汇编细节、Android 底层机制或复杂的 C++ 特性时。
- **要求**: 你应当**主动使用谷歌等搜索引擎**来查询相关资料、官方文档或开源实现，以获取足够的信息来支撑你的技术决策。不要在不确定的情况下编写代码。

### 6.2. 主动引导 LLDB 调试

- **背景**: 直接通过代码分析来定位崩溃通常非常困难。因此，使用 `lldb` 是本项目的**首选调试方案**。
- **要求**:
    - **主动引导**: 当你编写的代码导致崩溃，或用户报告问题时，你**必须主动引导用户使用 lldb 进行调试**，而不是等待用户提出。
    - **提供指令**: 你需要提供清晰、具体的 `lldb` 操作指令。例如，如何附加到进程 (`lldb -p <pid>`)、打印堆栈回溯 (`bt`)、查看寄存器状态 (`register read`)、读取内存 (`memory read <address>`) 等。
    - **分析结果**: 在用户提供 `lldb` 的输出后，由你来分析并定位问题根源。

### 6.3. 使用日志

- **策略**: 在调试复杂逻辑时，可以在代码中临时添加日志进行辅助。
- **要求**: 调试结束后，务必在最终代码中**删除所有用于调试的日志**。

---